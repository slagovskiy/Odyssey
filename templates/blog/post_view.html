{% extends "base.html" %}
{% load markup %}
{% load mathitils %}
{% block content %}
    <article>
        <header>
            <h2><a href="{{ post.get_absolute_url }}">{{ post.title }}</a></h2>
        </header>
        <hr>
        {{ post.teaser|markdown }}
        <hr>
        {{ post.content|markdown }}

        <table class="postinfo">
            <tr>
                <td><span class="icon-date_12"><time datetime="{{ post.published|date:"F jS, Y H:i" }}">{{ post.published|date:"F jS, Y H:i" }}</time></span></td>
                <td><span class="icon-user_12"><a href="#">{{ post.author.first_name }} {{ post.author.last_name }}</a></span></td>
                <td><span class="icon-view_12">{{ post.visitor_count }}</span></td>
                <td><span class="icon-comment_12">{{ post.comment_count }}</span></td>
            </tr>
            <tr><td colspan="4">
                <span class="icon-category_12">{% for category in post.categories.all %}
                <a href="{{ category.get_absolute_url }}">{{ category.name }}</a>{% if not forloop.last %}, {% endif %}
                {% endfor %}</span>
                <span class="icon-tag_12">{% for tag in post.tags.all %}
                    <a href="{{ tag.get_absolute_url }}">{{ tag.name }}</a>{% if not forloop.last %}, {% endif %}
                {% endfor %}</span>
            </td></tr>
        </table>

        <section role="comments">
            <div class="comments-title">{{ post.comment_count }} comment{% ifnotequal post.comment_count 1 %}s{% endifnotequal %}</div>
            <a href="#" onclick="moveReply(0); return false;" class="comments-subtitle">Leave comment</a><div id="reply_0" class="reply comment-form"></div>
            <div id="testetst"></div>
            <div class="comment-form" id="comment_form">
                <form method="post" action="{{ post.get_comment_save_url }}">
                    {% csrf_token %}
                    <input type="hidden" name="comment_reply" value="0">
                    <table>
                        <tr><td colspan="2"><textarea rows="1" id="comment_content" name="comment_content" placeholder="Leave comments here" class="input-full" onfocus="openForm1()"></textarea></td></tr>
                        <tr id="subform1"><td class="label">Name</td><td><input type="text" id="comment_name" name="comment_name" placeholder="Your name" class="input-with-text" onfocus="openForm2()"></td></tr>
                        <tr id="subform2"><td class="label">E-mail</td><td><input type="text" id="comment_email" name="comment_email" placeholder="Your email" class="input-with-text"></td></tr>
                        <tr id="subform3"><td class="label" colspan="2"><input type="checkbox" name="comment_subscribe" id="comment_subscribe" class="checkbox"> <label for="comment_subscribe">Track replies</label></td></tr>
                        <tr id="subform0"><td colspan="2">{% if post.comments_moderated %}<p>Comments will be published after validation<p>{% endif %}<input type="submit" id="comment_submit" name="comment_submit" class="input-button" value="Send"></td></tr>
                    </table>
                </form>
            </div>
            <ul>
                {% for comment in post.comments %}
                    <li id="comment_{{ comment.id }}" style="padding-left: {{ comment.level|mul:30 }}px;">
                    {% if comment.deleted %}
                            <p>Comment was deleted by the administrator</p>
                    {% else %}
                        {% if comment.allowed %}
                                <h5>{{ comment.name }}&nbsp;<time datetime="{{ comment.published|date:"F jS, Y H:i" }}" class="icon-date_8">{{ comment.published|date:"F jS, Y H:i" }}</time>&nbsp;<a href="#comment{{ comment.id }}" name="comment{{ comment.id }}">#</a></h5>
                                <p>{{ comment.content|escape|linebreaksbr }}</p>
                                {% if comment.allowed %}<span class="icon-reply_16"><a href="#" onclick="moveReply({{ comment.id }}); return false;">Reply</a></span><div id="reply_{{ comment.id }}" class="reply comment-form"></div>{% endif %}
                        {% endif %}
                    {% endif %}
                    </li>
                {% endfor %}
            </ul>
        </section>

    </article>
    <script>
       $(document).ready(function(){
           $( "#subform0, #subform1, #subform2, #subform3" ).hide();
           $("#comment_content, #comment_name, #comment_email, #comment_submit").corner("5px");
       });

       function openForm1()
        {
            $("#comment_content").animate({
                'height': '100px'
                }, 500);
            $("#subform0, #subform1").fadeIn("slow");
        }

        function openForm2()
        {
            $("#subform2, #subform3").fadeIn("slow");
        }

        function moveReply(id)
        {
            $("#comment_content").css({
                'height': '100px'
            });
            $("#subform0, #subform1, #subform2, #subform3").show();
            $(".reply").html('');
            $("#reply_"+id).html($("#comment_form").html());
            $("#reply_"+id).find("form").find("input[name='comment_reply']").val(id);
            $("#comment_form").hide();
        }
    </script>
{% endblock %}


